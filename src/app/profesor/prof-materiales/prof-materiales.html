<div class="perfil-container">
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="user-info">
        <div class="avatar">
          <span>{{ userName.substring(0, 2).toUpperCase() }}</span>
        </div>
        <div class="user-details">
          <h3>{{ userName }}</h3>
          <p class="user-role">{{ userRole === 'Profesor' ? 'Profesor' : 'Usuario' }} • {{ userAccountNumber }}</p>
          <p class="user-career">{{ userMateria }}</p>
        </div>
      </div>
    </div>
    <div class="header-right">
      <button class="notification-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span class="badge" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
      </button>
      <button class="logout-btn" (click)="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      </button>
    </div>
  </header>

  <!-- Contenido principal -->
  <div class="content-section">
    <div class="section-header">
      <div class="section-header-content">
        <div>
          <h2>Material del Curso</h2>
          <p class="section-description">
            Sube documentos oficiales, material de apoyo y avisos para tus estudiantes
          </p>
        </div>
        <button class="btn-upload" (click)="openUploadModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
          Subir Material
        </button>
      </div>
    </div>

    <!-- Barra de búsqueda y filtros -->
    <div class="filters-container">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          class="search-input"
          placeholder="Buscar materiales..."
          [(ngModel)]="searchText"
          (input)="onSearchChange()"
        />
      </div>

      <select class="filter-select" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
        <option *ngFor="let category of categories" [value]="category.value">
          {{ category.label }}
        </option>
      </select>
    </div>

    <!-- Estadísticas -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number">{{ totalMaterials }}</div>
        <div class="stat-label">Materiales</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ totalDownloads }}</div>
        <div class="stat-label">Descargas</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ totalNotices }}</div>
        <div class="stat-label">Avisos</div>
      </div>
    </div>

    <!-- Lista de materiales -->
    <div class="materials-list">
      <div 
        *ngFor="let material of filteredMaterials" 
        class="material-card">
        <div class="material-icon" [style.background-color]="material">
          <span>{{ material}}</span>
        </div>

        <div class="material-content">
          <div class="material-header">
            <h3 class="material-title">{{ material.title }}</h3>
            <span class="category-badge" [ngClass]="getCategoryClass(material.category)">
              {{ material.category }}
            </span>
          </div>

          <p class="material-description">{{ material.description }}</p>

          <div class="material-meta">
            <div class="meta-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
              </svg>
              <span>{{ material.fileName }}</span>
            </div>
            <div class="meta-item">
              <span>•</span>
              <span>{{ material.fileSize }}</span>
            </div>
            <div class="meta-item">
              <span>•</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              <span>{{ material.downloads }} descargas</span>
            </div>
          </div>

          <div class="material-meta">
            <div class="meta-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <span>Subido el {{ formatDate(material.uploadDate) }}</span>
            </div>
          </div>

          <div class="material-actions">
            <button class="btn-action btn-view" (click)="viewMaterial(material)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              Ver
            </button>
            <button class="btn-action btn-edit" (click)="openEditModal(material)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
              Editar
            </button>
            <button class="btn-action btn-delete" (click)="deleteMaterial(material)">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
              Eliminar
            </button>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay resultados -->
      <div *ngIf="filteredMaterials.length === 0" class="no-results">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <h3>No se encontraron materiales</h3>
        <p>Intenta con otros términos de búsqueda</p>
      </div>
    </div>
  </div>

  <!-- Modal: Subir Material -->
  <div class="modal-overlay" *ngIf="showUploadModal" (click)="closeUploadModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Subir Nuevo Material</h2>
        <button class="modal-close" (click)="closeUploadModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <p class="modal-description">Sube documentos oficiales, material de apoyo o avisos para tus estudiantes</p>

        <div class="form-section">
          <h3>Información del Material</h3>

          <div class="form-group">
            <label>Título <span class="required">*</span></label>
            <input 
              type="text" 
              class="form-input"
              placeholder="Ej: Guía de Estudio - Unidad 1"
              [(ngModel)]="uploadForm.title"
            />
          </div>

          <div class="form-group">
            <label>Descripción</label>
            <textarea 
              class="form-textarea"
              placeholder="Describe brevemente el contenido del material..."
              [(ngModel)]="uploadForm.description"
              rows="3"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Categoría <span class="required">*</span></label>
              <select class="form-select" [(ngModel)]="uploadForm.category">
                <option value="Material de Apoyo">Material de Apoyo</option>
                <option value="Guía">Guía</option>
                <option value="Aviso Oficial">Aviso Oficial</option>
                <option value="Examen">Examen</option>
                <option value="Tarea">Tarea</option>
                <option value="Otro">Otro</option>
              </select>
            </div>

            <div class="form-group">
              <label>Curso</label>
              <select class="form-select" [(ngModel)]="uploadForm.course">
                <option *ngFor="let course of courses" [value]="course">{{ course }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Semestre</label>
            <select class="form-select" [(ngModel)]="uploadForm.semester">
              <option *ngFor="let semester of semesters" [value]="semester">{{ semester }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Archivo <span class="required">*</span></label>
            <div class="file-upload-area">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <p *ngIf="!selectedFileName">Arrastra un archivo o haz clic para seleccionar</p>
              <p *ngIf="selectedFileName" class="file-selected">{{ selectedFileName }}</p>
              <button type="button" class="btn-select-file" (click)="fileInput.click()">
                Seleccionar Archivo
              </button>
              <input 
                #fileInput
                type="file" 
                hidden
                accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.png"
                (change)="onFileSelected($event)"
              />
              <p class="file-formats">Formatos: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, JPG, PNG (Max: 20MB)</p>
            </div>
          </div>

          <div class="form-summary" *ngIf="selectedFileName">
            <h4>Resumen:</h4>
            <ul>
              <li><strong>Título:</strong> {{ uploadForm.title || 'Sin título' }}</li>
              <li><strong>Categoría:</strong> {{ uploadForm.category }}</li>
              <li><strong>Curso:</strong> {{ uploadForm.course }}</li>
              <li><strong>Archivo:</strong> {{ selectedFileName }}</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-modal-cancel" (click)="closeUploadModal()">Cancelar</button>
        <button class="btn-modal-primary" (click)="uploadMaterial()">Subir Material</button>
      </div>
    </div>
  </div>

  <!-- Modal: Editar Material -->
  <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Editar Material</h2>
        <button class="modal-close" (click)="closeEditModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <p class="modal-description">Actualiza la información del material</p>

        <div class="form-section">
          <h3>Información del Material</h3>

          <div class="form-group">
            <label>Título <span class="required">*</span></label>
            <input 
              type="text" 
              class="form-input"
              [(ngModel)]="editForm.title"
            />
          </div>

          <div class="form-group">
            <label>Descripción</label>
            <textarea 
              class="form-textarea"
              [(ngModel)]="editForm.description"
              rows="3"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Categoría <span class="required">*</span></label>
              <select class="form-select" [(ngModel)]="editForm.category">
                <option value="Material de Apoyo">Material de Apoyo</option>
                <option value="Guía">Guía</option>
                <option value="Aviso Oficial">Aviso Oficial</option>
                <option value="Examen">Examen</option>
                <option value="Tarea">Tarea</option>
                <option value="Otro">Otro</option>
              </select>
            </div>

            <div class="form-group">
              <label>Curso</label>
              <select class="form-select" [(ngModel)]="editForm.course">
                <option *ngFor="let course of courses" [value]="course">{{ course }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Semestre</label>
            <select class="form-select" [(ngModel)]="editForm.semester">
              <option *ngFor="let semester of semesters" [value]="semester">{{ semester }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Reemplazar Archivo (Opcional)</label>
            <div class="file-upload-area">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
              </svg>
              <p *ngIf="!editFileName">Arrastra un archivo o haz clic para seleccionar</p>
              <p *ngIf="editFileName" class="file-selected">{{ editFileName }}</p>
              <button type="button" class="btn-select-file" (click)="editFileInput.click()">
                Seleccionar Archivo
              </button>
              <input 
                #editFileInput
                type="file" 
                hidden
                accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.png"
                (change)="onEditFileSelected($event)"
              />
              <p class="file-formats">Formatos: PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, JPG, PNG (Max: 20MB)</p>
            </div>
          </div>

          <div class="form-summary">
            <h4>Resumen:</h4>
            <ul>
              <li><strong>Título:</strong> {{ editForm.title }}</li>
              <li><strong>Categoría:</strong> {{ editForm.category }}</li>
              <li><strong>Curso:</strong> {{ editForm.course }}</li>
              <li><strong>Archivo:</strong> {{ editFileName || selectedMaterial?.fileName }}</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-modal-cancel" (click)="closeEditModal()">Cancelar</button>
        <button class="btn-modal-primary" (click)="updateMaterial()">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button 
      *ngFor="let item of navigationItems" 
      class="nav-item"
      [class.active]="item.route === currentRoute"
      (click)="navigateTo(item.route)">
      <div class="nav-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path [attr.d]="getIcon(item.icon)"></path>
        </svg>
        <span class="nav-badge" *ngIf="item.badge && item.badge > 0">{{ item.badge }}</span>
      </div>
      <span class="nav-label">{{ item.label }}</span>
    </button>
  </nav>
</div>